!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("mobx")):"function"==typeof define&&define.amd?define(["mobx"],e):"object"==typeof exports?exports["trood-restify"]=e(require("mobx")):t["trood-restify"]=e(t.mobx)}(this,(function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n.h="642fd04f71b4a87db7d2",n.cn="main",n(n.s=6)}([function(e,n){e.exports=t},function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return je}));var i,o=n(0),a="warn";function s(){return a}!function(t){t.afterCreate="afterCreate",t.afterAttach="afterAttach",t.afterCreationFinalization="afterCreationFinalization",t.beforeDetach="beforeDetach",t.beforeDestroy="beforeDestroy"}(i||(i={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function c(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var p=function(){return(p=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function l(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function h(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function d(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function y(t){return q(t,1),Q(t).type}function v(t,e){q(t,1),St(e,(function(t){return"object"==typeof t}),"object or array",2),Q(t).applyPatches(pt(e))}function b(t,e){void 0===e&&(e=!0),q(t,1);var n=Q(t);return e?n.snapshot:dt(n.type.getSnapshot(n,!1))}function g(t){return q(t,1),Q(t).root.storedValue}var m,w=function(){function t(t,e,n,r){this.type=t,this.environment=r,this._state=G.INITIALIZING,this.environment=r,this.baseSetParent(e,n)}return Object.defineProperty(t.prototype,"subpath",{get:function(){return this._subpath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subpathUponDeath",{get:function(){return this._subpathUponDeath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pathUponDeath",{get:function(){return this._pathUponDeath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.type.getValue(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(t){var e=this.isAlive;this._state=t;var n=this.isAlive;this.aliveAtom&&e!==n&&this.aliveAtom.reportChanged()},enumerable:!1,configurable:!0}),t.prototype.fireInternalHook=function(t){this._hookSubscribers&&this._hookSubscribers.emit(t,this,t)},t.prototype.registerHook=function(t,e){return this._hookSubscribers||(this._hookSubscribers=new bt),this._hookSubscribers.register(t,e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),t.prototype.baseSetParent=function(t,e){this._parent=t,this._subpath=e,this._escapedSubpath=void 0,this.pathAtom&&this.pathAtom.reportChanged()},Object.defineProperty(t.prototype,"path",{get:function(){return this.getEscapedPath(!0)},enumerable:!1,configurable:!0}),t.prototype.getEscapedPath=function(t){return t&&(this.pathAtom||(this.pathAtom=Object(o.createAtom)("path")),this.pathAtom.reportObserved()),this.parent?(void 0===this._escapedSubpath&&(this._escapedSubpath=this._subpath?Ot(this._subpath):""),this.parent.getEscapedPath(t)+"/"+this._escapedSubpath):""},Object.defineProperty(t.prototype,"isRoot",{get:function(){return null===this.parent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAlive",{get:function(){return this.state!==G.DEAD},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDetaching",{get:function(){return this.state===G.DETACHING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"observableIsAlive",{get:function(){return this.aliveAtom||(this.aliveAtom=Object(o.createAtom)("alive")),this.aliveAtom.reportObserved(),this.isAlive},enumerable:!1,configurable:!0}),t.prototype.baseFinalizeCreation=function(t){if(this.state===G.CREATED){if(this.parent){if(this.parent.state!==G.FINALIZED)return;this.fireHook(i.afterAttach)}this.state=G.FINALIZED,t&&t()}},t.prototype.baseFinalizeDeath=function(){this._hookSubscribers&&this._hookSubscribers.clearAll(),this._subpathUponDeath=this._subpath,this._pathUponDeath=this.getEscapedPath(!1),this.baseSetParent(null,""),this.state=G.DEAD},t.prototype.baseAboutToDie=function(){this.fireHook(i.beforeDestroy)},t}(),_=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n,r,i)||this;try{a.storedValue=e.createNewInstance(o)}catch(t){throw a.state=G.DEAD,t}return a.state=G.CREATED,a.finalizeCreation(),a}return c(e,t),Object.defineProperty(e.prototype,"root",{get:function(){if(!this.parent)throw at("This scalar node is not part of a tree");return this.parent.root},enumerable:!1,configurable:!0}),e.prototype.setParent=function(t,e){var n=this.parent!==t,r=this.subpath!==e;(n||r)&&(this.environment=void 0,this.baseSetParent(this.parent,e))},Object.defineProperty(e.prototype,"snapshot",{get:function(){return dt(this.getSnapshot())},enumerable:!1,configurable:!0}),e.prototype.getSnapshot=function(){return this.type.getSnapshot(this)},e.prototype.toString=function(){var t=(this.isAlive?this.path:this.pathUponDeath)||"<root>";return this.type.name+"@"+t+(this.isAlive?"":" [dead]")},e.prototype.die=function(){this.isAlive&&this.state!==G.DETACHING&&(this.aboutToDie(),this.finalizeDeath())},e.prototype.finalizeCreation=function(){this.baseFinalizeCreation()},e.prototype.aboutToDie=function(){this.baseAboutToDie()},e.prototype.finalizeDeath=function(){this.baseFinalizeDeath()},e.prototype.fireHook=function(t){this.fireInternalHook(t)},l([o.action],e.prototype,"die",null),e}(w),S=1,P={onError:function(t){throw t}},I=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n,r,i)||this;if(a.nodeId=++S,a.isProtectionEnabled=!0,a._autoUnbox=!0,a._isRunningAction=!1,a._hasSnapshotReaction=!1,a._observableInstanceState=0,a._cachedInitialSnapshotCreated=!1,a.unbox=a.unbox.bind(a),a._initialSnapshot=dt(o),a.identifierAttribute=e.identifierAttribute,n||(a.identifierCache=new Z),a._childNodes=e.initializeChildNodes(a,a._initialSnapshot),a.identifier=null,a.unnormalizedIdentifier=null,a.identifierAttribute&&a._initialSnapshot){var s=a._initialSnapshot[a.identifierAttribute];if(void 0===s){var u=a._childNodes[a.identifierAttribute];u&&(s=u.value)}if("string"!=typeof s&&"number"!=typeof s)throw at("Instance identifier '"+a.identifierAttribute+"' for type '"+a.type.name+"' must be a string or a number");a.identifier=Ae(s),a.unnormalizedIdentifier=s}return n?n.root.identifierCache.addNodeToCache(a):a.identifierCache.addNodeToCache(a),a}return c(e,t),e.prototype.applyPatches=function(t){this.createObservableInstanceIfNeeded(),this._applyPatches(t)},e.prototype.applySnapshot=function(t){this.createObservableInstanceIfNeeded(),this._applySnapshot(t)},e.prototype.createObservableInstanceIfNeeded=function(){0===this._observableInstanceState&&this.createObservableInstance()},e.prototype.createObservableInstance=function(){var t,e;this._observableInstanceState=1;for(var n=[],r=this.parent;r&&0===r._observableInstanceState;)n.unshift(r),r=r.parent;try{for(var a=h(n),s=a.next();!s.done;s=a.next()){s.value.createObservableInstanceIfNeeded()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}var u,c,p=this.type;try{this.storedValue=p.createNewInstance(this._childNodes),this.preboot(),this._isRunningAction=!0,p.finalizeNewInstance(this,this.storedValue)}catch(t){throw this.state=G.DEAD,t}finally{this._isRunningAction=!1}this._observableInstanceState=2,u=this,c="snapshot",Object(o.getAtom)(u,c).trackAndCompute(),this.isRoot&&this._addSnapshotReaction(),this._childNodes=it,this.state=G.CREATED,this.fireHook(i.afterCreate),this.finalizeCreation()},Object.defineProperty(e.prototype,"root",{get:function(){var t=this.parent;return t?t.root:this},enumerable:!1,configurable:!0}),e.prototype.clearParent=function(){if(this.parent){this.fireHook(i.beforeDetach);var t=this.state;this.state=G.DETACHING;var e=this.root,n=e.environment,r=e.identifierCache.splitCache(this);try{this.parent.removeChild(this.subpath),this.baseSetParent(null,""),this.environment=n,this.identifierCache=r}finally{this.state=t}}},e.prototype.setParent=function(t,e){var n=t!==this.parent,r=e!==this.subpath;(n||r)&&(n?(this.environment=void 0,t.root.identifierCache.mergeCache(this),this.baseSetParent(t,e),this.fireHook(i.afterAttach)):r&&this.baseSetParent(this.parent,e))},e.prototype.fireHook=function(t){var e=this;this.fireInternalHook(t);var n=this.storedValue&&"object"==typeof this.storedValue&&this.storedValue[t];"function"==typeof n&&(o._allowStateChangesInsideComputed?Object(o._allowStateChangesInsideComputed)((function(){n.apply(e.storedValue)})):n.apply(this.storedValue))},Object.defineProperty(e.prototype,"snapshot",{get:function(){return dt(this.getSnapshot())},enumerable:!1,configurable:!0}),e.prototype.getSnapshot=function(){return this.isAlive?2===this._observableInstanceState?this._getActualSnapshot():this._getCachedInitialSnapshot():this._snapshotUponDeath},e.prototype._getActualSnapshot=function(){return this.type.getSnapshot(this)},e.prototype._getCachedInitialSnapshot=function(){if(!this._cachedInitialSnapshotCreated){var t=this.type,e=this._childNodes,n=this._initialSnapshot;this._cachedInitialSnapshot=t.processInitialSnapshot(e,n),this._cachedInitialSnapshotCreated=!0}return this._cachedInitialSnapshot},e.prototype.isRunningAction=function(){return!!this._isRunningAction||!this.isRoot&&this.parent.isRunningAction()},e.prototype.assertAlive=function(t){var e=s();if(!this.isAlive&&"ignore"!==e){var n=this._getAssertAliveError(t);switch(e){case"error":throw at(n);case"warn":_t(n)}}},e.prototype._getAssertAliveError=function(t){var e=this.getEscapedPath(!1)||this.pathUponDeath||"",n=t.subpath&&Ot(t.subpath)||"",r=t.actionContext||N();r&&"action"!==r.type&&r.parentActionEvent&&(r=r.parentActionEvent);var i,o="";r&&null!=r.name&&(o=(r&&r.context&&(q(i=r.context,1),Q(i).path)||e)+"."+r.name+"()");return"You are trying to read or write to an object that is no longer part of a state tree. (Object type: '"+this.type.name+"', Path upon death: '"+e+"', Subpath: '"+n+"', Action: '"+o+"'). Either detach nodes first, or don't use objects after removing / replacing them in the tree."},e.prototype.getChildNode=function(t){this.assertAlive({subpath:t}),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildNode(this,t):this._childNodes[t]}finally{this._autoUnbox=!0}},e.prototype.getChildren=function(){this.assertAlive(it),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildren(this):nt(this._childNodes)}finally{this._autoUnbox=!0}},e.prototype.getChildType=function(t){return this.type.getChildType(t)},Object.defineProperty(e.prototype,"isProtected",{get:function(){return this.root.isProtectionEnabled},enumerable:!1,configurable:!0}),e.prototype.assertWritable=function(t){if(this.assertAlive(t),!this.isRunningAction()&&this.isProtected)throw at("Cannot modify '"+this+"', the object is protected and can only be modified by using an action.")},e.prototype.removeChild=function(t){this.type.removeChild(this,t)},e.prototype.unbox=function(t){return t?(this.assertAlive({subpath:t.subpath||t.subpathUponDeath}),this._autoUnbox?t.value:t):t},e.prototype.toString=function(){var t=(this.isAlive?this.path:this.pathUponDeath)||"<root>",e=this.identifier?"(id: "+this.identifier+")":"";return this.type.name+"@"+t+e+(this.isAlive?"":" [dead]")},e.prototype.finalizeCreation=function(){var t=this;this.baseFinalizeCreation((function(){var e,n;try{for(var r=h(t.getChildren()),o=r.next();!o.done;o=r.next()){o.value.finalizeCreation()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}t.fireInternalHook(i.afterCreationFinalization)}))},e.prototype.detach=function(){if(!this.isAlive)throw at("Error while detaching, node is not alive.");this.clearParent()},e.prototype.preboot=function(){var t=this;this._applyPatches=z(this.storedValue,"@APPLY_PATCHES",(function(e){e.forEach((function(e){var n=Et(e.path);et(t,n.slice(0,-1)).applyPatchLocally(n[n.length-1],e)}))})),this._applySnapshot=z(this.storedValue,"@APPLY_SNAPSHOT",(function(e){if(e!==t.snapshot)return t.type.applySnapshot(t,e)})),yt(this.storedValue,"$treenode",this),yt(this.storedValue,"toJSON",tt)},e.prototype.die=function(){this.isAlive&&this.state!==G.DETACHING&&(this.aboutToDie(),this.finalizeDeath())},e.prototype.aboutToDie=function(){0!==this._observableInstanceState&&(this.getChildren().forEach((function(t){t.aboutToDie()})),this.baseAboutToDie(),this._internalEventsEmit("dispose"),this._internalEventsClear("dispose"))},e.prototype.finalizeDeath=function(){this.getChildren().forEach((function(t){t.finalizeDeath()})),this.root.identifierCache.notifyDied(this);var t=this.snapshot;this._snapshotUponDeath=t,this._internalEventsClearAll(),this.baseFinalizeDeath()},e.prototype.onSnapshot=function(t){return this._addSnapshotReaction(),this._internalEventsRegister("snapshot",t)},e.prototype.emitSnapshot=function(t){this._internalEventsEmit("snapshot",t)},e.prototype.onPatch=function(t){return this._internalEventsRegister("patch",t)},e.prototype.emitPatch=function(t,e){if(this._internalEventsHasSubscribers("patch")){var n=f(function(t){if(!("oldValue"in t))throw at("Patches without `oldValue` field cannot be inversed");return[At(t),Tt(t)]}(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++){var i=e[r];for(var o in i)t[o]=i[o]}return t}({},t,{path:e.path.substr(this.path.length)+"/"+t.path})),2),r=n[0],i=n[1];this._internalEventsEmit("patch",r,i)}this.parent&&this.parent.emitPatch(t,e)},e.prototype.hasDisposer=function(t){return this._internalEventsHas("dispose",t)},e.prototype.addDisposer=function(t){if(this.hasDisposer(t))throw at("cannot add a disposer when it is already registered for execution");this._internalEventsRegister("dispose",t,!0)},e.prototype.removeDisposer=function(t){if(!this._internalEventsHas("dispose",t))throw at("cannot remove a disposer which was never registered for execution");this._internalEventsUnregister("dispose",t)},e.prototype.removeMiddleware=function(t){if(this.middlewares){var e=this.middlewares.indexOf(t);e>=0&&this.middlewares.splice(e,1)}},e.prototype.addMiddleWare=function(t,e){var n=this;void 0===e&&(e=!0);var r={handler:t,includeHooks:e};return this.middlewares?this.middlewares.push(r):this.middlewares=[r],function(){n.removeMiddleware(r)}},e.prototype.applyPatchLocally=function(t,e){this.assertWritable({subpath:t}),this.createObservableInstanceIfNeeded(),this.type.applyPatchLocally(this,t,e)},e.prototype._addSnapshotReaction=function(){var t=this;if(!this._hasSnapshotReaction){var e=Object(o.reaction)((function(){return t.snapshot}),(function(e){return t.emitSnapshot(e)}),P);this.addDisposer(e),this._hasSnapshotReaction=!0}},e.prototype._internalEventsHasSubscribers=function(t){return!!this._internalEvents&&this._internalEvents.hasSubscribers(t)},e.prototype._internalEventsRegister=function(t,e,n){return void 0===n&&(n=!1),this._internalEvents||(this._internalEvents=new bt),this._internalEvents.register(t,e,n)},e.prototype._internalEventsHas=function(t,e){return!!this._internalEvents&&this._internalEvents.has(t,e)},e.prototype._internalEventsUnregister=function(t,e){this._internalEvents&&this._internalEvents.unregister(t,e)},e.prototype._internalEventsEmit=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._internalEvents&&(e=this._internalEvents).emit.apply(e,d([t],n))},e.prototype._internalEventsClear=function(t){this._internalEvents&&this._internalEvents.clear(t)},e.prototype._internalEventsClearAll=function(){this._internalEvents&&this._internalEvents.clearAll()},l([o.action],e.prototype,"createObservableInstance",null),l([o.computed],e.prototype,"snapshot",null),l([o.action],e.prototype,"detach",null),l([o.action],e.prototype,"die",null),e}(w);!function(t){t[t.String=1]="String",t[t.Number=2]="Number",t[t.Boolean=4]="Boolean",t[t.Date=8]="Date",t[t.Literal=16]="Literal",t[t.Array=32]="Array",t[t.Map=64]="Map",t[t.Object=128]="Object",t[t.Frozen=256]="Frozen",t[t.Optional=512]="Optional",t[t.Reference=1024]="Reference",t[t.Identifier=2048]="Identifier",t[t.Late=4096]="Late",t[t.Refinement=8192]="Refinement",t[t.Union=16384]="Union",t[t.Null=32768]="Null",t[t.Undefined=65536]="Undefined",t[t.Integer=131072]="Integer",t[t.Custom=262144]="Custom",t[t.SnapshotProcessor=524288]="SnapshotProcessor"}(m||(m={}));var A=function(){function t(t){this.isType=!0,this.name=t}return t.prototype.create=function(t,e){return $(this,t),this.instantiate(null,"",e,t).value},t.prototype.getSnapshot=function(t,e){throw at("unimplemented method")},t.prototype.isAssignableFrom=function(t){return t===this},t.prototype.validate=function(t,e){if(X(t)){var n=y(t);return this.isAssignableFrom(n)?L():U(e,t)}return this.isValidSnapshot(t,e)},t.prototype.is=function(t){return 0===this.validate(t,[{path:"",type:this}]).length},Object.defineProperty(t.prototype,"Type",{get:function(){throw at("Factory.Type should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.Type`")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TypeWithoutSTN",{get:function(){throw at("Factory.TypeWithoutSTN should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.TypeWithoutSTN`")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"SnapshotType",{get:function(){throw at("Factory.SnapshotType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.SnapshotType`")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"CreationType",{get:function(){throw at("Factory.CreationType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.CreationType`")},enumerable:!1,configurable:!0}),l([o.action],t.prototype,"create",null),t}(),T=function(t){function e(e){return t.call(this,e)||this}return c(e,t),e.prototype.create=function(e,n){return void 0===e&&(e=this.getDefaultSnapshot()),t.prototype.create.call(this,e,n)},e.prototype.getValue=function(t){return t.createObservableInstanceIfNeeded(),t.storedValue},e.prototype.tryToReconcileNode=function(t,e){return!t.isDetaching&&(t.snapshot===e||(!(!K(e)||Q(e)!==t)||!(t.type!==this||!ht(e)||K(e)||t.identifierAttribute&&t.identifier!==Ae(e[t.identifierAttribute]))&&(t.applySnapshot(e),!0)))},e.prototype.reconcile=function(t,e,n,r){if(this.tryToReconcileNode(t,e))return t.setParent(n,r),t;if(t.die(),K(e)&&this.isAssignableFrom(y(e))){var i=Q(e);return i.setParent(n,r),i}return this.instantiate(n,r,void 0,e)},e.prototype.getSubTypes=function(){return null},l([o.action],e.prototype,"create",null),e}(A),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.createNewInstance=function(t){return t},e.prototype.getValue=function(t){return t.storedValue},e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.reconcile=function(t,e,n,r){if(!t.isDetaching&&t.type===this&&t.storedValue===e)return t;var i=this.instantiate(n,r,void 0,e);return t.die(),i},e.prototype.getSubTypes=function(){return null},e}(A);function j(t){return"object"==typeof t&&t&&!0===t.isType}function C(t,e){St(t,j,"mobx-state-tree type",e)}new Map;!function(){function t(t,e){this.hooks=t,this.call=e,this.flowsPending=0,this.running=!0,t&&t.onStart(e)}t.prototype.finish=function(t){this.running&&(this.running=!1,this.hooks&&this.hooks.onFinish(this.call,t))},t.prototype.incFlowsPending=function(){this.flowsPending++},t.prototype.decFlowsPending=function(){this.flowsPending--},Object.defineProperty(t.prototype,"hasFlowsPending",{get:function(){return this.flowsPending>0},enumerable:!1,configurable:!0})}();var E,V=1;function N(){return E}function D(){return V++}function x(t,e){var n=Q(t.context);"action"===t.type&&n.assertAlive({actionContext:t});var r=n._isRunningAction;n._isRunningAction=!0;var a=E;E=t;try{return function(t,e,n){var r=new R(t,n);if(r.isEmpty)return Object(o.action)(n).apply(null,e.args);var a=null;return function t(e){var s=r.getNextMiddleware(),u=s&&s.handler;return u?!s.includeHooks&&i[e.name]?t(e):(u(e,(function(e,n){!0,a=t(e),n&&(a=n(a))}),(function(t){!0,a=t})),a):Object(o.action)(n).apply(null,e.args)}(e)}(n,t,e)}finally{E=a,n._isRunningAction=r}}function k(t){if(t)return"action"===t.type?t:t.parentActionEvent}function z(t,e,n){var r=function(){var r=D(),i=E,o=k(i);return x({type:"action",name:e,id:r,args:gt(arguments),context:t,tree:g(t),rootId:i?i.rootId:r,parentId:i?i.id:0,allParentIds:i?d(i.allParentIds,[i.id]):[],parentEvent:i,parentActionEvent:o},n)};return r._isMSTAction=!0,r}var R=function(){function t(t,e){this.arrayIndex=0,this.inArrayIndex=0,this.middlewares=[],e.$mst_middleware&&this.middlewares.push(e.$mst_middleware);for(var n=t;n;)n.middlewares&&this.middlewares.push(n.middlewares),n=n.parent}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.middlewares.length<=0},enumerable:!1,configurable:!0}),t.prototype.getNextMiddleware=function(){var t=this.middlewares[this.arrayIndex];if(t){var e=t[this.inArrayIndex++];return e||(this.arrayIndex++,this.inArrayIndex=0,this.getNextMiddleware())}},t}();function F(t){return"function"==typeof t?"<function"+(t.name?" "+t.name:"")+">":K(t)?"<"+t+">":"`"+function(t){try{return JSON.stringify(t)}catch(t){return"<Unserializable: "+t+">"}}(t)+"`"}function M(t){var e=t.value,n=t.context[t.context.length-1].type,r=t.context.map((function(t){return t.path})).filter((function(t){return t.length>0})).join("/"),i=r.length>0?'at path "/'+r+'" ':"",o=K(e)?"value of type "+Q(e).type.name+":":ft(e)?"value":"snapshot",a=n&&K(e)&&n.is(Q(e).snapshot);return""+i+o+" "+F(e)+" is not assignable "+(n?"to type: `"+n.name+"`":"")+(t.message?" ("+t.message+")":"")+(n?function(t){return j(t)&&(t.flags&(m.String|m.Number|m.Integer|m.Boolean|m.Date))>0}(n)||ft(e)?".":", expected an instance of `"+n.name+"` or a snapshot like `"+n.describe()+"` instead."+(a?" (Note that a snapshot of the provided value is compatible with the targeted type)":""):".")}function H(t,e,n){return t.concat([{path:e,type:n}])}function L(){return rt}function U(t,e,n){return[{context:t,value:e,message:n}]}function W(t){return t.reduce((function(t,e){return t.concat(e)}),[])}function $(e,n){void 0!==t&&Object({PROD:!0,DEV:!1,NODE_ENV:"production"})&&"true"===Object({PROD:!0,DEV:!1,NODE_ENV:"production"}).ENABLE_TYPE_CHECK&&function(t,e){var n=t.validate(e,[{path:"",type:t}]);if(n.length>0)throw at(function(t,e,n){if(0===n.length)return;return"Error while converting "+(r=F(e),(r.length<280?r:r.substring(0,272)+"......"+r.substring(r.length-8))+" to `")+t.name+"`:\n\n    "+n.map(M).join("\n    ");var r}(t,e,n))}(e,n)}var G,Y=0,Z=function(){function t(){this.cacheId=Y++,this.cache=o.observable.map(),this.lastCacheModificationPerId=o.observable.map()}return t.prototype.updateLastCacheModificationPerId=function(t){var e=this.lastCacheModificationPerId.get(t);this.lastCacheModificationPerId.set(t,void 0===e?1:e+1)},t.prototype.getLastCacheModificationPerId=function(t){var e=this.lastCacheModificationPerId.get(t)||0;return this.cacheId+"-"+e},t.prototype.addNodeToCache=function(t,e){if(void 0===e&&(e=!0),t.identifierAttribute){var n=t.identifier;this.cache.has(n)||this.cache.set(n,o.observable.array([],ot));var r=this.cache.get(n);if(-1!==r.indexOf(t))throw at("Already registered");r.push(t),e&&this.updateLastCacheModificationPerId(n)}},t.prototype.mergeCache=function(t){var e=this;Object(o.values)(t.identifierCache.cache).forEach((function(t){return t.forEach((function(t){e.addNodeToCache(t)}))}))},t.prototype.notifyDied=function(t){if(t.identifierAttribute){var e=t.identifier,n=this.cache.get(e);n&&(n.remove(t),n.length||this.cache.delete(e),this.updateLastCacheModificationPerId(t.identifier))}},t.prototype.splitCache=function(e){var n=this,r=new t,i=e.path;return Object(o.entries)(this.cache).forEach((function(t){for(var e=f(t,2),o=e[0],a=e[1],s=!1,u=a.length-1;u>=0;u--)0===a[u].path.indexOf(i)&&(r.addNodeToCache(a[u],!1),a.splice(u,1),s=!0);s&&n.updateLastCacheModificationPerId(o)})),r},t.prototype.has=function(t,e){var n=this.cache.get(e);return!!n&&n.some((function(e){return t.isAssignableFrom(e.type)}))},t.prototype.resolve=function(t,e){var n=this.cache.get(e);if(!n)return null;var r=n.filter((function(e){return t.isAssignableFrom(e.type)}));switch(r.length){case 0:return null;case 1:return r[0];default:throw at("Cannot resolve a reference to type '"+t.name+"' with id: '"+e+"' unambigously, there are multiple candidates: "+r.map((function(t){return t.path})).join(", "))}},t}();function B(t,e,n,r,i){var o=X(i);if(o){if(o.parent)throw at("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+(e?e.path:"")+"/"+n+"', but it lives already at '"+o.path+"'");return e&&o.setParent(e,n),o}return new I(t,e,n,r,i)}function J(t,e,n,r,i){return new _(t,e,n,r,i)}function K(t){return!(!t||!t.$treenode)}function q(t,e){St(t,K,"mobx-state-tree node",e)}function Q(t){if(!K(t))throw at("Value "+t+" is no MST Node");return t.$treenode}function X(t){return t&&t.$treenode||null}function tt(){return Q(this).snapshot}!function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CREATED=1]="CREATED",t[t.FINALIZED=2]="FINALIZED",t[t.DETACHING=3]="DETACHING",t[t.DEAD=4]="DEAD"}(G||(G={}));function et(t,e,n){void 0===n&&(n=!0);for(var r=t,i=0;i<e.length;i++){var o=e[i];if(".."===o){if(r=r.parent)continue}else{if("."===o)continue;if(r){if(r instanceof _)try{var a=r.value;K(a)&&(r=Q(a))}catch(t){if(!n)return;throw t}if(r instanceof I)if(r.getChildType(o)&&(r=r.getChildNode(o)))continue}}if(n)throw at("Could not resolve '"+o+"' in path '"+(Ct(e.slice(0,i))||"/")+"' while resolving '"+Ct(e)+"'");return}return r}function nt(t){if(!t)return rt;var e=Object.keys(t);if(!e.length)return rt;var n=new Array(e.length);return e.forEach((function(e,r){n[r]=t[e]})),n}var rt=Object.freeze([]),it=Object.freeze({}),ot="string"==typeof o.$mobx?{deep:!1}:{deep:!1,proxy:!1};function at(t){return void 0===t&&(t="Illegal state"),new Error("[mobx-state-tree] "+t)}function st(t){return t}Object.freeze(ot);var ut=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function ct(t){return Array.isArray(t)||Object(o.isObservableArray)(t)}function pt(t){return t?ct(t)?t:[t]:rt}function lt(t){if(null===t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}function ht(t){return!(null===t||"object"!=typeof t||t instanceof Date||t instanceof RegExp)}function ft(t,e){return void 0===e&&(e=!0),null==t||!!("string"==typeof t||"number"==typeof t||"boolean"==typeof t||e&&t instanceof Date)}function dt(t){return t}function yt(t,e,n){Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!0,value:n})}var vt=function(){function t(){this.handlers=[]}return Object.defineProperty(t.prototype,"hasSubscribers",{get:function(){return this.handlers.length>0},enumerable:!1,configurable:!0}),t.prototype.register=function(t,e){var n=this;return void 0===e&&(e=!1),e?this.handlers.unshift(t):this.handlers.push(t),function(){n.unregister(t)}},t.prototype.has=function(t){return this.handlers.indexOf(t)>=0},t.prototype.unregister=function(t){var e=this.handlers.indexOf(t);e>=0&&this.handlers.splice(e,1)},t.prototype.clear=function(){this.handlers.length=0},t.prototype.emit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.handlers.slice();n.forEach((function(e){return e.apply(void 0,d(t))}))},t}(),bt=function(){function t(){}return t.prototype.hasSubscribers=function(t){var e=this.eventHandlers&&this.eventHandlers[t];return!!e&&e.hasSubscribers},t.prototype.register=function(t,e,n){void 0===n&&(n=!1),this.eventHandlers||(this.eventHandlers={});var r=this.eventHandlers[t];return r||(r=this.eventHandlers[t]=new vt),r.register(e,n)},t.prototype.has=function(t,e){var n=this.eventHandlers&&this.eventHandlers[t];return!!n&&n.has(e)},t.prototype.unregister=function(t,e){var n=this.eventHandlers&&this.eventHandlers[t];n&&n.unregister(e)},t.prototype.clear=function(t){this.eventHandlers&&delete this.eventHandlers[t]},t.prototype.clearAll=function(){this.eventHandlers=void 0},t.prototype.emit=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.eventHandlers&&this.eventHandlers[t];i&&(e=i).emit.apply(e,d(n))},t}();function gt(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=t[n];return e}function mt(t,e){return 0===t.indexOf(e)}var wt=function(t,e){};function _t(t){console.warn(new Error("[mobx-state-tree] "+t))}function St(t,e,n,r){0}function Pt(t,e){St()}function It(t,e,n){void 0===n&&(n=!0),St(),n||St()}function At(t){switch(t.op){case"add":return{op:"add",path:t.path,value:t.value};case"remove":return{op:"remove",path:t.path};case"replace":return{op:"replace",path:t.path,value:t.value}}}function Tt(t){switch(t.op){case"add":return{op:"remove",path:t.path};case"remove":return{op:"add",path:t.path,value:t.oldValue};case"replace":return{op:"replace",path:t.path,value:t.oldValue}}}function Ot(t){return!0==("number"==typeof t)?""+t:-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function jt(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Ct(t){if(0===t.length)return"";var e=function(t){return t.map(Ot).join("/")};return"."===t[0]||".."===t[0]?e(t):"/"+e(t)}function Et(t){var e=t.split("/").map(jt);if(!(""===t||"."===t||".."===t||mt(t,"/")||mt(t,"./")||mt(t,"../")))throw at("a json path must be either rooted, empty or relative, but got '"+t+"'");return""===e[0]&&e.shift(),e}wt.ids={};var Vt=function(t){function e(e,n,r){var i=t.call(this,r||e.name)||this;return i._subtype=e,i._processors=n,i}return c(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return this._subtype.flags|m.SnapshotProcessor},enumerable:!1,configurable:!0}),e.prototype.describe=function(){return"snapshotProcessor("+this._subtype.describe()+")"},e.prototype.preProcessSnapshot=function(t){return this._processors.preProcessor?this._processors.preProcessor.call(null,t):t},e.prototype.postProcessSnapshot=function(t){return this._processors.postProcessor?this._processors.postProcessor.call(null,t):t},e.prototype._fixNode=function(t){var e=this;!function(t,e){for(var n,r,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];try{for(var a=h(i),s=a.next();!s.done;s=a.next()){var u=s.value;t[u]=e[u].bind(e)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}(t.type,this,"isAssignableFrom","create");var n=t.getSnapshot;t.getSnapshot=function(){return e.postProcessSnapshot(n.call(t))}},e.prototype.instantiate=function(t,e,n,r){var i=K(r)?r:this.preProcessSnapshot(r),o=this._subtype.instantiate(t,e,n,i);return this._fixNode(o),o},e.prototype.reconcile=function(t,e,n,r){var i=this._subtype.reconcile(t,K(e)?e:this.preProcessSnapshot(e),n,r);return i!==t&&this._fixNode(i),i},e.prototype.getSnapshot=function(t,e){void 0===e&&(e=!0);var n=this._subtype.getSnapshot(t);return e?this.postProcessSnapshot(n):n},e.prototype.isValidSnapshot=function(t,e){var n=this.preProcessSnapshot(t);return this._subtype.validate(n,e)},e.prototype.getSubTypes=function(){return this._subtype},e.prototype.is=function(t){var e=j(t)?this._subtype:K(t)?b(t,!1):this.preProcessSnapshot(t);return 0===this._subtype.validate(e,[{path:"",type:this._subtype}]).length},e}(A);var Nt,Dt="Map.put can only be used to store complex values that have an identifier type attribute";!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.YES=1]="YES",t[t.NO=2]="NO"}(Nt||(Nt={}));var xt=function(t){function e(e){return t.call(this,e,o.observable.ref.enhancer)||this}return c(e,t),e.prototype.get=function(e){return t.prototype.get.call(this,""+e)},e.prototype.has=function(e){return t.prototype.has.call(this,""+e)},e.prototype.delete=function(e){return t.prototype.delete.call(this,""+e)},e.prototype.set=function(e,n){return t.prototype.set.call(this,""+e,n)},e.prototype.put=function(t){if(!t)throw at("Map.put cannot be used to set empty values");if(K(t)){var e=Q(t);if(null===e.identifier)throw at(Dt);return this.set(e.identifier,t),t}if(ht(t)){var n=Q(this),r=n.type;if(r.identifierMode!==Nt.YES)throw at(Dt);var i=t[r.mapIdentifierAttribute];if(!Te(i)){var o=this.put(r.getChildType().create(t,n.environment));return this.put(b(o))}var a=Ae(i);return this.set(a,t),this.get(a)}throw at("Map.put can only be used to store complex values")},e}(o.ObservableMap),kt=function(t){function e(e,n,r){void 0===r&&(r=[]);var i=t.call(this,e)||this;return i._subType=n,i.identifierMode=Nt.UNKNOWN,i.mapIdentifierAttribute=void 0,i.flags=m.Map,i.hookInitializers=[],i._determineIdentifierMode(),i.hookInitializers=r,i}return c(e,t),e.prototype.hooks=function(t){var n=this.hookInitializers.length>0?this.hookInitializers.concat(t):[t];return new e(this.name,this._subType,n)},e.prototype.instantiate=function(t,e,n,r){return this._determineIdentifierMode(),B(this,t,e,n,r)},e.prototype._determineIdentifierMode=function(){if(this.identifierMode===Nt.UNKNOWN){var t=[];if(function t(e,n){var r,i,o=e.getSubTypes();if("cannotDetermine"===o)return!1;if(o){var a=pt(o);try{for(var s=h(a),u=s.next();!u.done;u=s.next()){if(!t(u.value,n))return!1}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return e instanceof Wt&&n.push(e),!0}(this._subType,t)){var e=void 0;t.forEach((function(t){if(t.identifierAttribute){if(e&&e!==t.identifierAttribute)throw at("The objects in a map should all have the same identifier attribute, expected '"+e+"', but child of type '"+t.name+"' declared attribute '"+t.identifierAttribute+"' as identifier");e=t.identifierAttribute}})),e?(this.identifierMode=Nt.YES,this.mapIdentifierAttribute=e):this.identifierMode=Nt.NO}}},e.prototype.initializeChildNodes=function(t,e){void 0===e&&(e={});var n=t.type._subType,r={};return Object.keys(e).forEach((function(i){r[i]=n.instantiate(t,i,void 0,e[i])})),r},e.prototype.createNewInstance=function(t){return new xt(t)},e.prototype.finalizeNewInstance=function(t,e){Object(o._interceptReads)(e,t.unbox),t.type.hookInitializers.forEach((function(t){var n=t(e);Object.keys(n).forEach((function(t){var r=n[t],i=z(e,t,r);yt(e,t,i)}))})),Object(o.intercept)(e,this.willChange),Object(o.observe)(e,this.didChange)},e.prototype.describe=function(){return"Map<string, "+this._subType.describe()+">"},e.prototype.getChildren=function(t){return Object(o.values)(t.storedValue)},e.prototype.getChildNode=function(t,e){var n=t.storedValue.get(""+e);if(!n)throw at("Not a child "+e);return n},e.prototype.willChange=function(t){var e=Q(t.object),n=t.name;e.assertWritable({subpath:n});var r=e.type,i=r._subType;switch(t.type){case"update":var o=t.newValue;if(o===t.object.get(n))return null;$(i,o),t.newValue=i.reconcile(e.getChildNode(n),t.newValue,e,n),r.processIdentifier(n,t.newValue);break;case"add":$(i,t.newValue),t.newValue=i.instantiate(e,n,void 0,t.newValue),r.processIdentifier(n,t.newValue)}return t},e.prototype.processIdentifier=function(t,e){if(this.identifierMode===Nt.YES&&e instanceof I){var n=e.identifier;if(n!==t)throw at("A map of objects containing an identifier should always store the object under their own identifier. Trying to store key '"+n+"', but expected: '"+t+"'")}},e.prototype.getSnapshot=function(t){var e={};return t.getChildren().forEach((function(t){e[t.subpath]=t.snapshot})),e},e.prototype.processInitialSnapshot=function(t){var e={};return Object.keys(t).forEach((function(n){e[n]=t[n].getSnapshot()})),e},e.prototype.didChange=function(t){var e=Q(t.object);switch(t.type){case"update":return void e.emitPatch({op:"replace",path:Ot(t.name),value:t.newValue.snapshot,oldValue:t.oldValue?t.oldValue.snapshot:void 0},e);case"add":return void e.emitPatch({op:"add",path:Ot(t.name),value:t.newValue.snapshot,oldValue:void 0},e);case"delete":var n=t.oldValue.snapshot;return t.oldValue.die(),void e.emitPatch({op:"remove",path:Ot(t.name),oldValue:n},e)}},e.prototype.applyPatchLocally=function(t,e,n){var r=t.storedValue;switch(n.op){case"add":case"replace":r.set(e,n.value);break;case"remove":r.delete(e)}},e.prototype.applySnapshot=function(t,e){$(this,e);var n=t.storedValue,r={};if(Array.from(n.keys()).forEach((function(t){r[t]=!1})),e)for(var i in e)n.set(i,e[i]),r[""+i]=!0;Object.keys(r).forEach((function(t){!1===r[t]&&n.delete(t)}))},e.prototype.getChildType=function(){return this._subType},e.prototype.isValidSnapshot=function(t,e){var n=this;return lt(t)?W(Object.keys(t).map((function(r){return n._subType.validate(t[r],H(e,r,n._subType))}))):U(e,t,"Value is not a plain object")},e.prototype.getDefaultSnapshot=function(){return it},e.prototype.removeChild=function(t,e){t.storedValue.delete(e)},l([o.action],e.prototype,"applySnapshot",null),e}(T);var zt=function(t){function e(e,n,r){void 0===r&&(r=[]);var i=t.call(this,e)||this;return i._subType=n,i.flags=m.Array,i.hookInitializers=[],i.hookInitializers=r,i}return c(e,t),e.prototype.hooks=function(t){var n=this.hookInitializers.length>0?this.hookInitializers.concat(t):[t];return new e(this.name,this._subType,n)},e.prototype.instantiate=function(t,e,n,r){return B(this,t,e,n,r)},e.prototype.initializeChildNodes=function(t,e){void 0===e&&(e=[]);var n=t.type._subType,r={};return e.forEach((function(e,i){var o=""+i;r[o]=n.instantiate(t,o,void 0,e)})),r},e.prototype.createNewInstance=function(t){return o.observable.array(nt(t),ot)},e.prototype.finalizeNewInstance=function(t,e){Object(o._getAdministration)(e).dehancer=t.unbox,t.type.hookInitializers.forEach((function(t){var n=t(e);Object.keys(n).forEach((function(t){var r=n[t],i=z(e,t,r);yt(e,t,i)}))})),Object(o.intercept)(e,this.willChange),Object(o.observe)(e,this.didChange)},e.prototype.describe=function(){return this._subType.describe()+"[]"},e.prototype.getChildren=function(t){return t.storedValue.slice()},e.prototype.getChildNode=function(t,e){var n=Number(e);if(n<t.storedValue.length)return t.storedValue[n];throw at("Not a child: "+e)},e.prototype.willChange=function(t){var e=Q(t.object);e.assertWritable({subpath:""+t.index});var n=e.type._subType,r=e.getChildren();switch(t.type){case"update":if(t.newValue===t.object[t.index])return null;var i=Rt(e,n,[r[t.index]],[t.newValue],[t.index]);if(!i)return null;t.newValue=i[0];break;case"splice":var o=t.index,a=t.removedCount,s=t.added,u=Rt(e,n,r.slice(o,o+a),s,s.map((function(t,e){return o+e})));if(!u)return null;t.added=u;for(var c=o+a;c<r.length;c++)r[c].setParent(e,""+(c+s.length-a))}return t},e.prototype.getSnapshot=function(t){return t.getChildren().map((function(t){return t.snapshot}))},e.prototype.processInitialSnapshot=function(t){var e=[];return Object.keys(t).forEach((function(n){e.push(t[n].getSnapshot())})),e},e.prototype.didChange=function(t){var e=Q(t.object);switch(t.type){case"update":return void e.emitPatch({op:"replace",path:""+t.index,value:t.newValue.snapshot,oldValue:t.oldValue?t.oldValue.snapshot:void 0},e);case"splice":for(var n=t.removedCount-1;n>=0;n--)e.emitPatch({op:"remove",path:""+(t.index+n),oldValue:t.removed[n].snapshot},e);for(n=0;n<t.addedCount;n++)e.emitPatch({op:"add",path:""+(t.index+n),value:e.getChildNode(""+(t.index+n)).snapshot,oldValue:void 0},e);return}},e.prototype.applyPatchLocally=function(t,e,n){var r=t.storedValue,i="-"===e?r.length:Number(e);switch(n.op){case"replace":r[i]=n.value;break;case"add":r.splice(i,0,n.value);break;case"remove":r.splice(i,1)}},e.prototype.applySnapshot=function(t,e){$(this,e),t.storedValue.replace(e)},e.prototype.getChildType=function(){return this._subType},e.prototype.isValidSnapshot=function(t,e){var n=this;return ct(t)?W(t.map((function(t,r){return n._subType.validate(t,H(e,""+r,n._subType))}))):U(e,t,"Value is not an array")},e.prototype.getDefaultSnapshot=function(){return rt},e.prototype.removeChild=function(t,e){t.storedValue.splice(Number(e),1)},l([o.action],e.prototype,"applySnapshot",null),e}(T);function Rt(t,e,n,r,i){for(var o,a=!0,s=0;;s++){var u=s<=r.length-1,c=n[s],p=u?r[s]:void 0,l=""+i[s];if(((o=p)instanceof _||o instanceof I)&&(p=p.storedValue),!c&&!u)break;if(u)if(c)if(Mt(c,p))n[s]=Ft(e,t,l,p,c);else{for(var h=void 0,f=s;f<n.length;f++)if(Mt(n[f],p)){h=n.splice(f,1)[0];break}a=!1;d=Ft(e,t,l,p,h);n.splice(s,0,d)}else{if(K(p)&&Q(p).parent===t)throw at("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+t.path+"/"+l+"', but it lives already at '"+Q(p).path+"'");a=!1;var d=Ft(e,t,l,p);n.splice(s,0,d)}else a=!1,n.splice(s,1),c instanceof I&&c.createObservableInstanceIfNeeded(),c.die(),s--}return a?null:n}function Ft(t,e,n,r,i){$(t,r);var o=function(){if(K(r)){var o=Q(r);if(o.assertAlive(it),null!==o.parent&&o.parent===e)return o.setParent(e,n),o}return i?t.reconcile(i,r,e,n):t.instantiate(e,n,void 0,r)}();return i&&i!==o&&(i instanceof I&&i.createObservableInstanceIfNeeded(),i.die()),o}function Mt(t,e){if(!t.isAlive)return!1;if(K(e)){var n=Q(e);return n.isAlive&&n===t}return t.snapshot===e||t instanceof I&&null!==t.identifier&&t.identifierAttribute&&lt(e)&&t.identifier===Ae(e[t.identifierAttribute])&&t.type.is(e)}function Ht(){return Q(this).toString()}var Lt={name:"AnonymousModel",properties:{},initializers:rt};function Ut(t){return Object.keys(t).reduce((function(t,e){var n,r,o;if(e in i)throw at("Hook '"+e+"' was defined as property. Hooks should be defined as part of the actions");var a=Object.getOwnPropertyDescriptor(t,e);if("get"in a)throw at("Getters are not supported as properties. Please use views instead");var s=a.value;if(null==s)throw at("The default value of an attribute cannot be null or undefined as the type cannot be inferred. Did you mean `types.maybe(someType)`?");if(ft(s))return Object.assign({},t,((n={})[e]=ae(function(t){switch(typeof t){case"string":return Yt;case"number":return Zt;case"boolean":return Jt;case"object":if(t instanceof Date)return Xt}throw at("Cannot determine primitive type from value "+t)}(s),s),n));if(s instanceof kt)return Object.assign({},t,((r={})[e]=ae(s,{}),r));if(s instanceof zt)return Object.assign({},t,((o={})[e]=ae(s,[]),o));if(j(s))return t;throw at("Invalid type definition for property '"+e+"', cannot infer a type from a value like '"+s+"' ("+typeof s+")")}),t)}var Wt=function(t){function e(e){var n=t.call(this,e.name||Lt.name)||this;return n.flags=m.Object,n.named=function(t){return n.cloneAndEnhance({name:t})},n.props=function(t){return n.cloneAndEnhance({properties:t})},n.preProcessSnapshot=function(t){var e=n.preProcessor;return e?n.cloneAndEnhance({preProcessor:function(n){return e(t(n))}}):n.cloneAndEnhance({preProcessor:t})},n.postProcessSnapshot=function(t){var e=n.postProcessor;return e?n.cloneAndEnhance({postProcessor:function(n){return t(e(n))}}):n.cloneAndEnhance({postProcessor:t})},Object.assign(n,Lt,e),n.properties=Ut(n.properties),n.properties,n.propertyNames=Object.keys(n.properties),n.identifierAttribute=n._getIdentifierAttribute(),n}return c(e,t),e.prototype._getIdentifierAttribute=function(){var t=void 0;return this.forAllProps((function(e,n){if(n.flags&m.Identifier){if(t)throw at("Cannot define property '"+e+"' as object identifier, property '"+t+"' is already defined as identifier property");t=e}})),t},e.prototype.cloneAndEnhance=function(t){return new e({name:t.name||this.name,properties:Object.assign({},this.properties,t.properties),initializers:this.initializers.concat(t.initializers||[]),preProcessor:t.preProcessor||this.preProcessor,postProcessor:t.postProcessor||this.postProcessor})},e.prototype.actions=function(t){var e=this;return this.cloneAndEnhance({initializers:[function(n){return e.instantiateActions(n,t(n)),n}]})},e.prototype.instantiateActions=function(t,e){if(!lt(e))throw at("actions initializer should return a plain object containing actions");Object.keys(e).forEach((function(n){if("preProcessSnapshot"===n)throw at("Cannot define action 'preProcessSnapshot', it should be defined using 'type.preProcessSnapshot(fn)' instead");if("postProcessSnapshot"===n)throw at("Cannot define action 'postProcessSnapshot', it should be defined using 'type.postProcessSnapshot(fn)' instead");var r=e[n],o=t[n];if(n in i&&o){var a=r;r=function(){o.apply(null,arguments),a.apply(null,arguments)}}var s=r.$mst_middleware,u=r.bind(e);u.$mst_middleware=s;var c=z(t,n,u);e[n]=c,yt(t,n,c)}))},e.prototype.volatile=function(t){var e=this;if("function"!=typeof t)throw at("You passed an "+typeof t+" to volatile state as an argument, when function is expected");return this.cloneAndEnhance({initializers:[function(n){return e.instantiateVolatileState(n,t(n)),n}]})},e.prototype.instantiateVolatileState=function(t,e){if(!lt(e))throw at("volatile state initializer should return a plain object containing state");Object(o.set)(t,e)},e.prototype.extend=function(t){var e=this;return this.cloneAndEnhance({initializers:[function(n){var r=t(n),i=r.actions,o=r.views,a=r.state,s=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(r,["actions","views","state"]);for(var u in s)throw at("The `extend` function should return an object with a subset of the fields 'actions', 'views' and 'state'. Found invalid key '"+u+"'");return a&&e.instantiateVolatileState(n,a),o&&e.instantiateViews(n,o),i&&e.instantiateActions(n,i),n}]})},e.prototype.views=function(t){var e=this;return this.cloneAndEnhance({initializers:[function(n){return e.instantiateViews(n,t(n)),n}]})},e.prototype.instantiateViews=function(t,e){if(!lt(e))throw at("views initializer should return a plain object containing views");Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);if("get"in r)if(Object(o.isComputedProp)(t,n)){var i=Object(o._getAdministration)(t,n);i.derivation=r.get,i.scope=t,r.set&&(i.setter=Object(o.action)(i.name+"-setter",r.set))}else Object(o.computed)(t,n,r,!0);else{if("function"!=typeof r.value)throw at("A view member should either be a function or getter based property");yt(t,n,r.value)}}))},e.prototype.instantiate=function(t,e,n,r){return B(this,t,e,n,K(r)?r:this.applySnapshotPreProcessor(r))},e.prototype.initializeChildNodes=function(t,e){void 0===e&&(e={});var n=t.type,r={};return n.forAllProps((function(n,i){r[n]=i.instantiate(t,n,void 0,e[n])})),r},e.prototype.createNewInstance=function(t){return o.observable.object(t,it,ot)},e.prototype.finalizeNewInstance=function(t,e){yt(e,"toString",Ht),this.forAllProps((function(n){Object(o._interceptReads)(e,n,t.unbox)})),this.initializers.reduce((function(t,e){return e(t)}),e),Object(o.intercept)(e,this.willChange),Object(o.observe)(e,this.didChange)},e.prototype.willChange=function(t){var e=t,n=Q(e.object),r=e.name;n.assertWritable({subpath:r});var i=n.type.properties[r];return i&&($(i,e.newValue),e.newValue=i.reconcile(n.getChildNode(r),e.newValue,n,r)),e},e.prototype.didChange=function(t){var e=t,n=Q(e.object);if(n.type.properties[e.name]){var r=e.oldValue?e.oldValue.snapshot:void 0;n.emitPatch({op:"replace",path:Ot(e.name),value:e.newValue.snapshot,oldValue:r},n)}},e.prototype.getChildren=function(t){var e=this,n=[];return this.forAllProps((function(r){n.push(e.getChildNode(t,r))})),n},e.prototype.getChildNode=function(t,e){if(!(e in this.properties))throw at("Not a value property: "+e);var n=Object(o._getAdministration)(t.storedValue,e).value;if(!n)throw at("Node not available for property "+e);return n},e.prototype.getSnapshot=function(t,e){var n=this;void 0===e&&(e=!0);var r={};return this.forAllProps((function(e,i){Object(o.getAtom)(t.storedValue,e).reportObserved(),r[e]=n.getChildNode(t,e).snapshot})),e?this.applySnapshotPostProcessor(r):r},e.prototype.processInitialSnapshot=function(t){var e={};return Object.keys(t).forEach((function(n){e[n]=t[n].getSnapshot()})),this.applySnapshotPostProcessor(e)},e.prototype.applyPatchLocally=function(t,e,n){if("replace"!==n.op&&"add"!==n.op)throw at("object does not support operation "+n.op);t.storedValue[e]=n.value},e.prototype.applySnapshot=function(t,e){var n=this.applySnapshotPreProcessor(e);$(this,n),this.forAllProps((function(e){t.storedValue[e]=n[e]}))},e.prototype.applySnapshotPreProcessor=function(t){var e=this.preProcessor;return e?e.call(null,t):t},e.prototype.applySnapshotPostProcessor=function(t){var e=this.postProcessor;return e?e.call(null,t):t},e.prototype.getChildType=function(t){return It(),this.properties[t]},e.prototype.isValidSnapshot=function(t,e){var n=this,r=this.applySnapshotPreProcessor(t);return lt(r)?W(this.propertyNames.map((function(t){return n.properties[t].validate(r[t],H(e,t,n.properties[t]))}))):U(e,r,"Value is not a plain object")},e.prototype.forAllProps=function(t){var e=this;this.propertyNames.forEach((function(n){return t(n,e.properties[n])}))},e.prototype.describe=function(){var t=this;return"{ "+this.propertyNames.map((function(e){return e+": "+t.properties[e].describe()})).join("; ")+" }"},e.prototype.getDefaultSnapshot=function(){return it},e.prototype.removeChild=function(t,e){t.storedValue[e]=void 0},l([o.action],e.prototype,"applySnapshot",null),e}(T);function $t(t){return j(t)&&(t.flags&m.Object)>0}var Gt=function(t){function e(e,n,r,i){void 0===i&&(i=st);var o=t.call(this,e)||this;return o.flags=n,o.checker=r,o.initializer=i,o.flags=n,o}return c(e,t),e.prototype.describe=function(){return this.name},e.prototype.instantiate=function(t,e,n,r){return J(this,t,e,n,r)},e.prototype.createNewInstance=function(t){return this.initializer(t)},e.prototype.isValidSnapshot=function(t,e){return ft(t)&&this.checker(t)?L():U(e,t,"Value is not a "+("Date"===this.name?"Date or a unix milliseconds timestamp":this.name))},e}(O),Yt=new Gt("string",m.String,(function(t){return"string"==typeof t})),Zt=new Gt("number",m.Number,(function(t){return"number"==typeof t})),Bt=new Gt("integer",m.Integer,(function(t){return ut(t)})),Jt=new Gt("boolean",m.Boolean,(function(t){return"boolean"==typeof t})),Kt=new Gt("null",m.Null,(function(t){return null===t})),qt=new Gt("undefined",m.Undefined,(function(t){return void 0===t})),Qt=new Gt("Date",m.Date,(function(t){return"number"==typeof t||t instanceof Date}),(function(t){return t instanceof Date?t:new Date(t)}));Qt.getSnapshot=function(t){return t.storedValue.getTime()};var Xt=Qt;var te=function(t){function e(e){var n=t.call(this,JSON.stringify(e))||this;return n.flags=m.Literal,n.value=e,n}return c(e,t),e.prototype.instantiate=function(t,e,n,r){return J(this,t,e,n,r)},e.prototype.describe=function(){return JSON.stringify(this.value)},e.prototype.isValidSnapshot=function(t,e){return ft(t)&&t===this.value?L():U(e,t,"Value is not a literal "+JSON.stringify(this.value))},e}(O);function ee(t){return St(),new te(t)}var ne=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o._subtype=n,o._predicate=r,o._message=i,o}return c(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return this._subtype.flags|m.Refinement},enumerable:!1,configurable:!0}),e.prototype.describe=function(){return this.name},e.prototype.instantiate=function(t,e,n,r){return this._subtype.instantiate(t,e,n,r)},e.prototype.isAssignableFrom=function(t){return this._subtype.isAssignableFrom(t)},e.prototype.isValidSnapshot=function(t,e){var n=this._subtype.validate(t,e);if(n.length>0)return n;var r=K(t)?Q(t).snapshot:t;return this._predicate(r)?L():U(e,t,this._message(t))},e.prototype.reconcile=function(t,e,n,r){return this._subtype.reconcile(t,e,n,r)},e.prototype.getSubTypes=function(){return this._subtype},e}(A);var re=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i._types=n,i._eager=!0,r=p({eager:!0,dispatcher:void 0},r),i._dispatcher=r.dispatcher,r.eager||(i._eager=!1),i}return c(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){var t=m.Union;return this._types.forEach((function(e){t|=e.flags})),t},enumerable:!1,configurable:!0}),e.prototype.isAssignableFrom=function(t){return this._types.some((function(e){return e.isAssignableFrom(t)}))},e.prototype.describe=function(){return"("+this._types.map((function(t){return t.describe()})).join(" | ")+")"},e.prototype.instantiate=function(t,e,n,r){var i=this.determineType(r,void 0);if(!i)throw at("No matching type for union "+this.describe());return i.instantiate(t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){var i=this.determineType(e,t.type);if(!i)throw at("No matching type for union "+this.describe());return i.reconcile(t,e,n,r)},e.prototype.determineType=function(t,e){return this._dispatcher?this._dispatcher(t):e?e.is(t)?e:this._types.filter((function(t){return t!==e})).find((function(e){return e.is(t)})):this._types.find((function(e){return e.is(t)}))},e.prototype.isValidSnapshot=function(t,e){if(this._dispatcher)return this._dispatcher(t).validate(t,e);for(var n=[],r=0,i=0;i<this._types.length;i++){var o=this._types[i].validate(t,e);if(0===o.length){if(this._eager)return L();r++}else n.push(o)}return 1===r?L():U(e,t,"No type is applicable for the union").concat(W(n))},e.prototype.getSubTypes=function(){return this._types},e}(A);function ie(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=j(t)?void 0:t,i=j(t)?d([t],e):e,o="("+i.map((function(t){return t.name})).join(" | ")+")";return new re(o,i,r)}var oe=function(t){function e(e,n,r){var i=t.call(this,e.name)||this;return i._subtype=e,i._defaultValue=n,i.optionalValues=r,i}return c(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return this._subtype.flags|m.Optional},enumerable:!1,configurable:!0}),e.prototype.describe=function(){return this._subtype.describe()+"?"},e.prototype.instantiate=function(t,e,n,r){if(this.optionalValues.indexOf(r)>=0){var i=this.getDefaultInstanceOrSnapshot();return this._subtype.instantiate(t,e,n,i)}return this._subtype.instantiate(t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){return this._subtype.reconcile(t,this.optionalValues.indexOf(e)<0&&this._subtype.is(e)?e:this.getDefaultInstanceOrSnapshot(),n,r)},e.prototype.getDefaultInstanceOrSnapshot=function(){var t="function"==typeof this._defaultValue?this._defaultValue():this._defaultValue;return"function"==typeof this._defaultValue&&$(this,t),t},e.prototype.isValidSnapshot=function(t,e){return this.optionalValues.indexOf(t)>=0?L():this._subtype.validate(t,e)},e.prototype.isAssignableFrom=function(t){return this._subtype.isAssignableFrom(t)},e.prototype.getSubTypes=function(){return this._subtype},e}(A);function ae(t,e,n){return function(t,e){if("function"!=typeof e&&K(e))throw at("default value cannot be an instance, pass a snapshot or a function that creates an instance/snapshot instead");C(t,1)}(t,e),new oe(t,e,n||se)}var se=[void 0];var ue=ae(qt,void 0),ce=ae(Kt,null);function pe(t){return C(t,1),ie(t,ue)}var le=function(t){function e(e,n){var r=t.call(this,e)||this;return r._definition=n,r}return c(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return(this._subType?this._subType.flags:0)|m.Late},enumerable:!1,configurable:!0}),e.prototype.getSubType=function(t){if(!this._subType){var e=void 0;try{e=this._definition()}catch(t){if(!(t instanceof ReferenceError))throw t;e=void 0}if(t&&void 0===e)throw at("Late type seems to be used too early, the definition (still) returns undefined");e&&(this._subType=e)}return this._subType},e.prototype.instantiate=function(t,e,n,r){return this.getSubType(!0).instantiate(t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){return this.getSubType(!0).reconcile(t,e,n,r)},e.prototype.describe=function(){var t=this.getSubType(!1);return t?t.name:"<uknown late type>"},e.prototype.isValidSnapshot=function(t,e){var n=this.getSubType(!1);return n?n.validate(t,e):L()},e.prototype.isAssignableFrom=function(t){var e=this.getSubType(!1);return!!e&&e.isAssignableFrom(t)},e.prototype.getSubTypes=function(){var t=this.getSubType(!1);return t||"cannotDetermine"},e}(A);var he=function(t){function e(e){var n=t.call(this,e?"frozen("+e.name+")":"frozen")||this;return n.subType=e,n.flags=m.Frozen,n}return c(e,t),e.prototype.describe=function(){return"<any immutable value>"},e.prototype.instantiate=function(t,e,n,r){return J(this,t,e,n,r)},e.prototype.isValidSnapshot=function(t,e){return function(t){return"function"!=typeof t}(t)?this.subType?this.subType.validate(t,e):L():U(e,t,"Value is not serializable and cannot be frozen")},e}(O),fe=new he;var de=function(){function t(t,e){if(this.targetType=e,Te(t))this.identifier=t;else{if(!K(t))throw at("Can only store references to tree nodes or identifiers, got: '"+t+"'");var n=Q(t);if(!n.identifierAttribute)throw at("Can only store references with a defined identifier attribute.");var r=n.unnormalizedIdentifier;if(null==r)throw at("Can only store references to tree nodes with a defined identifier.");this.identifier=r}}return t.prototype.updateResolvedReference=function(t){var e=Ae(this.identifier),n=t.root,r=n.identifierCache.getLastCacheModificationPerId(e);if(!this.resolvedReference||this.resolvedReference.lastCacheModification!==r){var i=this.targetType,o=n.identifierCache.resolve(i,e);if(!o)throw new ye("[mobx-state-tree] Failed to resolve reference '"+this.identifier+"' to type '"+this.targetType.name+"' (from node: "+t.path+")");this.resolvedReference={node:o,lastCacheModification:r}}},Object.defineProperty(t.prototype,"resolvedValue",{get:function(){return this.updateResolvedReference(this.node),this.resolvedReference.node.value},enumerable:!1,configurable:!0}),t}(),ye=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return c(e,t),e}(Error),ve=function(t){function e(e,n){var r=t.call(this,"reference("+e.name+")")||this;return r.targetType=e,r.onInvalidated=n,r.flags=m.Reference,r}return c(e,t),e.prototype.describe=function(){return this.name},e.prototype.isAssignableFrom=function(t){return this.targetType.isAssignableFrom(t)},e.prototype.isValidSnapshot=function(t,e){return Te(t)?L():U(e,t,"Value is not a valid identifier, which is a string or a number")},e.prototype.fireInvalidated=function(t,e,n,r){var i=e.parent;if(i&&i.isAlive){var o=i.storedValue;o&&this.onInvalidated({cause:t,parent:o,invalidTarget:r?r.storedValue:void 0,invalidId:n,replaceRef:function(t){v(e.root.storedValue,{op:"replace",value:t,path:e.path})},removeRef:function(){$t(i.type)?this.replaceRef(void 0):v(e.root.storedValue,{op:"remove",path:e.path})}})}},e.prototype.addTargetNodeWatcher=function(t,e){var n=this,r=this.getValue(t);if(r){var o=Q(r),a=function(r,a){var s=function(t){switch(t){case i.beforeDestroy:return"destroy";case i.beforeDetach:return"detach";default:return}}(a);s&&n.fireInvalidated(s,t,e,o)},s=o.registerHook(i.beforeDetach,a),u=o.registerHook(i.beforeDestroy,a);return function(){s(),u()}}},e.prototype.watchTargetNodeForInvalidations=function(t,e,n){var r=this;if(this.onInvalidated){var o;t.registerHook(i.beforeDestroy,(function(){o&&o()}));var a=function(i){o&&o();var a=t.parent,s=a&&a.storedValue;if(a&&a.isAlive&&s){(n?!!n.get(e,s):t.root.identifierCache.has(r.targetType,Ae(e)))?o=r.addTargetNodeWatcher(t,e):i||r.fireInvalidated("invalidSnapshotReference",t,e,null)}};t.state===G.FINALIZED?a(!0):(t.isRoot||t.root.registerHook(i.afterCreationFinalization,(function(){t.parent&&t.parent.createObservableInstanceIfNeeded()})),t.registerHook(i.afterAttach,(function(){a(!1)})))}},e}(O),be=function(t){function e(e,n){return t.call(this,e,n)||this}return c(e,t),e.prototype.getValue=function(t){if(t.isAlive)return t.storedValue.resolvedValue},e.prototype.getSnapshot=function(t){return t.storedValue.identifier},e.prototype.instantiate=function(t,e,n,r){var i,o=K(r)?(q(i=r,1),Q(i).identifier):r,a=new de(r,this.targetType),s=J(this,t,e,n,a);return a.node=s,this.watchTargetNodeForInvalidations(s,o,void 0),s},e.prototype.reconcile=function(t,e,n,r){if(!t.isDetaching&&t.type===this){var i=K(e),o=t.storedValue;if(!i&&o.identifier===e||i&&o.resolvedValue===e)return t.setParent(n,r),t}var a=this.instantiate(n,r,void 0,e);return t.die(),a},e}(ve),ge=function(t){function e(e,n,r){var i=t.call(this,e,r)||this;return i.options=n,i}return c(e,t),e.prototype.getValue=function(t){if(t.isAlive)return this.options.get(t.storedValue,t.parent?t.parent.storedValue:null)},e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.instantiate=function(t,e,n,r){var i=K(r)?this.options.set(r,t?t.storedValue:null):r,o=J(this,t,e,n,i);return this.watchTargetNodeForInvalidations(o,i,this.options),o},e.prototype.reconcile=function(t,e,n,r){var i=K(e)?this.options.set(e,t?t.storedValue:null):e;if(!t.isDetaching&&t.type===this&&t.storedValue===i)return t.setParent(n,r),t;var o=this.instantiate(n,r,void 0,i);return t.die(),o},e}(ve);function me(t,e){C(t,1);var n=e||void 0,r=e?e.onInvalidated:void 0;return n&&(n.get||n.set)?new ge(t,{get:n.get,set:n.set},r):new be(t,r)}var we=function(t){function e(e,n){var r=t.call(this,e)||this;return r.validType=n,r.flags=m.Identifier,r}return c(e,t),e.prototype.instantiate=function(t,e,n,r){if(!(t&&t.type instanceof Wt))throw at("Identifier types can only be instantiated as direct child of a model type");return J(this,t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){if(t.storedValue!==e)throw at("Tried to change identifier from '"+t.storedValue+"' to '"+e+"'. Changing identifiers is not allowed.");return t.setParent(n,r),t},e.prototype.isValidSnapshot=function(t,e){return typeof t!==this.validType?U(e,t,"Value is not a valid "+this.describe()+", expected a "+this.validType):L()},e}(O),_e=function(t){function e(){var e=t.call(this,"identifier","string")||this;return e.flags=m.Identifier,e}return c(e,t),e.prototype.describe=function(){return"identifier"},e}(we),Se=function(t){function e(){return t.call(this,"identifierNumber","number")||this}return c(e,t),e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.describe=function(){return"identifierNumber"},e}(we),Pe=new _e,Ie=new Se;function Ae(t){return""+t}function Te(t){return"string"==typeof t||"number"==typeof t}var Oe=function(t){function e(e){var n=t.call(this,e.name)||this;return n.options=e,n.flags=m.Custom,n}return c(e,t),e.prototype.describe=function(){return this.name},e.prototype.isValidSnapshot=function(t,e){if(this.options.isTargetType(t))return L();var n=this.options.getValidationMessage(t);return n?U(e,t,"Invalid value for type '"+this.name+"': "+n):L()},e.prototype.getSnapshot=function(t){return this.options.toSnapshot(t.storedValue)},e.prototype.instantiate=function(t,e,n,r){return J(this,t,e,n,this.options.isTargetType(r)?r:this.options.fromSnapshot(r,t&&t.root.environment))},e.prototype.reconcile=function(t,e,n,r){var i=!this.options.isTargetType(e);if(!t.isDetaching&&(t.type===this&&(i?e===t.snapshot:e===t.storedValue)))return t.setParent(n,r),t;var o=i?this.options.fromSnapshot(e,n.root.environment):e,a=this.instantiate(n,r,void 0,o);return t.die(),a},e}(O),je={enumeration:function(t,e){var n="string"==typeof t?e:t,r=ie.apply(void 0,d(n.map((function(t){return ee(""+t)}))));return"string"==typeof t&&(r.name=t),r},model:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0]?t.shift():"AnonymousModel",r=t.shift()||{};return new Wt({name:n,properties:r})},compose:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0],r=n?t[0]:"AnonymousModel";return n&&t.shift(),t.reduce((function(t,e){return t.cloneAndEnhance({name:t.name+"_"+e.name,properties:e.properties,initializers:e.initializers,preProcessor:function(n){return e.applySnapshotPreProcessor(t.applySnapshotPreProcessor(n))},postProcessor:function(n){return e.applySnapshotPostProcessor(t.applySnapshotPostProcessor(n))}})})).named(r)},custom:function(t){return new Oe(t)},reference:me,safeReference:function(t,e){var n=me(t,p(p({},e),{onInvalidated:function(t){t.removeRef()}}));return e&&!1===e.acceptsUndefined?n:pe(n)},union:ie,optional:ae,literal:ee,maybe:pe,maybeNull:function(t){return C(t,1),ie(t,ce)},refinement:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0]?t.shift():j(t[0])?t[0].name:null,r=t[0],i=t[1],o=t[2]?t[2]:function(t){return"Value does not respect the refinement predicate"};return C(r,[1,2]),It(),Pt(),Pt(),new ne(n,r,i,o)},string:Yt,boolean:Jt,number:Zt,integer:Bt,Date:Xt,map:function(t){return new kt("map<string, "+t.name+">",t)},array:function(t){return C(t,1),new zt(t.name+"[]",t)},frozen:function(t){return 0===arguments.length?fe:j(t)?new he(t):ae(fe,t)},identifier:Pe,identifierNumber:Ie,late:function(t,e){var n="string"==typeof t?t:"late("+t.toString()+")",r="string"==typeof t?e:t;return new le(n,r)},undefined:qt,null:Kt,snapshotProcessor:function(t,e,n){return C(t,1),new Vt(t,e,n)}}}).call(this,n(2),n(4).setImmediate)},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var u,c=[],p=!1,l=-1;function h(){p&&u&&(p=!1,u.length?c=u.concat(c):l=-1,c.length&&f())}function f(){if(!p){var t=s(h);p=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,p=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||p||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(5),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(3))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},p=!1,l=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){d(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){o.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,r=function(t){var e=l.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(d,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&d(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}),h.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},h.clearImmediate=f}function f(t){delete c[t]}function d(t){if(p)setTimeout(d,0,t);else{var e=c[t];if(e){p=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{f(t),p=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(3),n(2))},function(t,e,n){"use strict";n.r(e),n.d(e,"getStore",(function(){return d}));var r=n(1);const i=/fk\((.*)\)/,o=/fk_array\((.*)\)/,a=(t,e,n)=>r.a.late(()=>r.a.reference(n(t),{get:n=>e()[t].items.get(n),set:(t,e)=>(console.log(t,e),t)})),s=(t="",e=!1,n,s)=>{if(e)return"number"===t?r.a.identifierNumber:r.a.identifier;if(r.a[t])return r.a.maybeNull(r.a[t]);const u=t.match(i);if(u)return r.a.maybeNull(a(u[1],n,s));const c=t.match(o);return c?r.a.maybeNull(r.a.array(a(c[1],n,s))):r.a.maybeNull(r.a.frozen())};var u=(t,e,n,a,u)=>{const c=((t,e,n,a)=>{const u=Object.keys(e.fields).reduce((t,r)=>{const i=e.fields[r];return{...t,[r]:s(i,r===e.pk,n,a)}},{$loadedById:!1});return r.a.model(t,u).views(t=>({get pk(){return t[e.pk]},getFieldType(t){const n=e.fields[t],r=n.match(i);if(r)return{type:a(r[1]),isReference:!0};const s=n.match(o);return s?{type:a(s[1]),isReference:!0,isReferenceArray:!0}:{type:n,isSimple:!0,isIdentifier:t===e.pk}}}))})(t,e,n,a);u(t,c);const p=r.a.model(t+"Map",{mapUuid:r.a.identifier,items:r.a.map(r.a.reference(c))});return r.a.model(t+"List",{modelName:r.a.identifier,items:r.a.map(c),lists:r.a.map(p)}).views(t=>({getByPk:e=>t.items.get(e)||{}})).actions(t=>({createItem(e){const r=c.identifierAttribute;if("object"==typeof e){const i=e[r],o={[r]:i};t.items.set(i,o);const a=t.items.get(i),s={};return Object.keys(e).forEach(t=>{const r=a.getFieldType(t);if(r.isSimple)s[t]=e[t];else if(r.isReference){const i=n();r.isReferenceArray?s[t]=e[t].map(t=>i[r.type.name].createItem(t)):s[t]=i[r.type.name].createItem(e[t])}}),t.items.set(i,s),i}return t.items.set(e,{[r]:e}),e},createList(e,n=[]){const r=n.reduce((e,n)=>{const r=t.createItem(n);return{...e,[r]:r}},{});t.lists.put({mapUuid:e,items:r})}}))};const c={};let p={};const l=()=>p,h=t=>c[t],f=(t,e)=>{c[t]=e};var d=(t={})=>(Object.keys(t).forEach(e=>{const n=u(e,t[e],l,h,f);p[e]=n.create({modelName:e,lists:{}})}),p)}])}));